# Dialog Component Testing Guide

## Current Status

Dialog コンポーネントのテストでは、以下の点に注意が必要です：

1. Radix UI の Dialog コンポーネントが内部で `Presence` を使用
2. アニメーションや非同期の状態更新を含む
3. テスト環境での React の状態更新の適切な制御が必要

## テストの実装方法

### 1. act の使用

React 19 からは、`act` は `react` パッケージから直接インポートすることが推奨されています：

```typescript
// 非推奨
import { act } from '@testing-library/react';

// 推奨
import { act } from 'react';
```

非同期の状態更新を含むテストでは、以下のパターンを使用します：

```typescript
// ユーザーイベントの設定
const user = userEvent.setup();

// イベントの発火
await act(async () => {
  await user.click(element);
});

// 状態の変更を待機
await waitFor(() => {
  expect(element).toHaveAttribute('data-state', 'checked');
});
```

### 2. テストの安定性向上

以下の方法でテストの安定性を向上させることができます：

1. `userEvent.setup()` を使用して適切なイベント設定
2. `act` で非同期の状態更新を制御
3. `waitFor` で状態の変更を待機
4. 適切なアサーションの選択

## テストすべき項目

1. 基本的な機能
   - 開閉の動作
   - フォーカスの管理
   - ESCキーでの閉じる動作

2. アクセシビリティ
   - ARIA属性の検証
   - キーボード操作
   - フォーカストラップ

3. カスタマイズ
   - 異なるサイズ
   - カスタムコンテンツ
   - ヘッダー/フッターの設定

## 実装時の注意点

1. テストの安定性を優先
   - アニメーションの無効化を検討
   - 必要最小限のアサーションに留める

2. テスト範囲の適切な選択
   - ユニットテストで扱う範囲を限定
   - 複雑な動作はE2Eテストに委ねる

3. エラー処理
   - エッジケースの考慮
   - エラー状態の検証

4. パフォーマンス
   - テストの実行時間
   - 不要な待機の削減

## 補完的なテスト方法

以下のテスト方法を組み合わせることで、より包括的なテストが可能です：

### 1. E2Eテスト（Playwright/Cypress）

- 実際のブラウザ環境でのテスト
- アニメーションの完了を正確に待機可能
- ユーザーの実際の操作フローを再現可能

### 2. Storybook Test Runner

- コンポーネントの視覚的なテスト
- インタラクションのテスト
- アクセシビリティのテスト

### 3. スナップショットテスト

- コンポーネントの構造変更の検知
- 基本的なマークアップの検証 